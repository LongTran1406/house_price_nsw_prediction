<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dataset Insights</title>

  <style>
    :root{
      --bg:#0f1724; --card:#0b1220; --muted:#94a3b8; --accent:#10b981; --danger:#ef4444;
      --glass: rgba(255,255,255,0.03);
      --max-width:700px;
      font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      color:#e6eef8;
    }
    html,body{height:100%; margin:0; padding:32px; background:linear-gradient(180deg,#071021,var(--bg)); box-sizing:border-box;}
    .wrap-vertical{max-width: var(--max-width); margin: 0 auto; display: grid; gap: 24px;}
    .card{background: var(--card); border-radius:12px; padding:18px; box-shadow:0 6px 18px rgba(2,6,23,0.6); border:1px solid rgba(255,255,255,0.03);}
    h1,h3{margin:0 0 12px 0}
    label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
    select,input{width:100%; padding:10px; border-radius:8px; border:1px solid rgba(255,255,255,0.06); background:var(--glass); color:var(--muted); font-size:14px; box-sizing:border-box; margin-bottom:6px;}
    button.btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:10px;border:none; background:linear-gradient(90deg,var(--accent),#06b6d4);color:#04202b;font-weight:600;cursor:pointer; box-shadow: 0 6px 16px rgba(16,185,129,0.14);}
    .muted{color:var(--muted); font-size:13px;}
    .small{font-size:12px;color:var(--muted);}
    img.plot-img{width:100%; border-radius:8px; border:1px solid rgba(255,255,255,0.04);}
    .grid-summary{display:grid; grid-template-columns:1fr 1fr; gap:12px;}
    @media(max-width:480px){.grid-summary{grid-template-columns:1fr;}}
    .navbar{display:flex; gap:20px; padding:12px 0; margin-bottom:24px; border-bottom:1px solid rgba(255,255,255,0.05);}
    .navbar a{color:var(--muted); text-decoration:none; font-weight:600; padding:6px 12px; border-radius:6px;}
    .navbar a.active, .navbar a:hover{background:var(--accent); color:#04202b;}
  </style>
</head>
<body>
    
  <div class="wrap-vertical">
    <div class="navbar">
      <a href="/">Home</a>
      <a href="/prediction" >House Price Predictor</a>
      <a href="/dataset_insights" class="active">Dataset Insights</a>
    </div>

    <!-- 1️⃣ Feature Selection & Plot -->
    <div class="card">
      <h1>Dataset Analysis</h1>
      <p class="muted">Select a feature to generate summary statistics and visualization.</p>

      <label for="feature">Feature</label>
      <select id="feature">
        <option value="bedroom_nums">Bedrooms</option>
        <option value="bathroom_nums">Bathrooms</option>
        <option value="car_spaces">Car Spaces</option>
        <option value="land_size">Land Size (m²)</option>
        <option value="dist_to_city">Distance to City (km)</option>
        <option value="avg_price_by_postcode">Avg Price by Postcode</option>
        <option value="postcode_avg_price_per_m2">Avg Price/m² by Postcode</option>
        <option value="city">City</option>
        <option value="postcode">Postcode</option>
      </select>

      <button id="plotBtn" class="btn" style="margin-top:12px;">Show Plot</button>
      <div id="status" class="muted small">Idle</div>
    </div>

    <!-- 2️⃣ Summary Statistics -->
    <div class="card">
      <h3>Summary Statistics</h3>
      <div id="summary" class="grid-summary"></div>
    </div>

    <!-- 3️⃣ Avg Info by Postcode -->
    <div class="card">
      <h3>Average Info by Postcode</h3>
      <p class="muted">Enter a postcode to see average feature values in that postcode.</p>
      <label for="postcode-input">Postcode</label>
      <input type="text" id="postcode-input" placeholder="e.g., 2000">
      <button class="btn" id="postcodeBtn">Show Averages</button>
      <div id="postcodeInfo" class="grid-summary" style="margin-top:12px;"></div>
    </div>

    <!-- 4️⃣ Visualization Plot -->
    <div class="card">
      <h3>Visualization</h3>
      <img id="analysisPlot" src="" alt="Analysis Plot" class="plot-img"/>
    </div>

    <!-- 5️⃣ Scatterplot -->
    <div class="card">
      <h3>Price vs Feature Scatterplot</h3>
      <label for="scatter-feature">Feature</label>
      <select id="scatter-feature">
        <option value="land_size">Land Size (m²)</option>
        <option value="bedroom_nums">Bedrooms</option>
        <option value="bathroom_nums">Bathrooms</option>
        <option value="car_spaces">Car Spaces</option>
        <option value="dist_to_city">Distance to City (km)</option>
      </select>
      <button class="btn" onclick="getScatter()" style="margin-top:12px;">Generate Scatterplot</button>
      <div id="scatter-result" style="margin-top:12px;"></div>
    </div>

  </div>

  <script>
    // Feature plot
    document.getElementById("plotBtn").addEventListener("click", async () => {
      const feature = document.getElementById("feature").value;
      const status = document.getElementById("status");
      const summaryDiv = document.getElementById("summary");
      status.textContent = "Generating plot...";
      summaryDiv.innerHTML = "";

      try {
        const res = await fetch("/analysis_plot", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ feature })
        });
        const data = await res.json();
        if(data.error) throw new Error(data.error);

        document.getElementById("analysisPlot").src = data.plot_url;
        status.textContent = "Done";

        if(data.summary){
          Object.entries(data.summary).forEach(([key,val])=>{
            summaryDiv.innerHTML += `<div style="background:rgba(255,255,255,0.03); padding:10px; border-radius:6px;">
              <p style="color:var(--accent); font-weight:600;">${key}</p>
              <p>${val}</p>
            </div>`;
          });
        }
      } catch(err){
        status.textContent = "Error: "+err.message;
      }
    });

    // Postcode average
    document.getElementById("postcodeBtn").addEventListener("click", async () => {
    const postcode = document.getElementById("postcode-input").value.trim();
    const postcodeDiv = document.getElementById("postcodeInfo");
    postcodeDiv.innerHTML = "Loading...";

    if(!postcode){
        postcodeDiv.innerHTML = "Please enter a postcode.";
        return;
    }

    try {
        const res = await fetch("/postcode_avg", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ postcode })
        });
        const data = await res.json();
        if(data.error){
        postcodeDiv.innerHTML = "Error: " + data.error;
        return;
        }

        postcodeDiv.innerHTML = "";
        Object.entries(data.avg_by_postcode).forEach(([key, val]) => {
        postcodeDiv.innerHTML += `<div style="background:rgba(255,255,255,0.03); padding:10px; border-radius:6px;">
            <p style="color:var(--accent); font-weight:600;">${key}</p>
            <p>${val}</p>
        </div>`;
        });

    } catch(err){
        postcodeDiv.innerHTML = "Error: " + err.message;
    }
    });

    // Scatterplot
    async function getScatter(){
      const feature = document.getElementById("scatter-feature").value;
      const response = await fetch("/scatter_plot", {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({feature})
      });
      const data = await response.json();
      if(data.plot_url){
        document.getElementById("scatter-result").innerHTML = `<img src="${data.plot_url}" alt="Scatterplot" class="plot-img"/>`;
      } else {
        alert("Error: "+data.error);
      }
    }
  </script>
</body>
</html>
